<!-- /demo/src/main/resources/templates/pages/stock/similar-advanced.html -->
<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìœ ì‚¬ ì¢…ëª© ì¡°íšŒ (Advanced)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ìœ ì§€ */
  </style>
</head>
<body>
<div layout:fragment="content">
  <div class="content-container">
    <h2>ğŸ“Š ìœ ì‚¬ ì¢…ëª© ì¡°íšŒ (Advanced)</h2>
    <div class="controls">
      <input type="text" id="companyInput" placeholder="íšŒì‚¬ëª… ì…ë ¥" value="ì¼€ì´ì—”ì•Œì‹œìŠ¤í…œ">
      <input type="date" id="startDate" value="2024-03-07">
      <input type="date" id="endDate" value="2024-12-09">
      <button id="fetchBtn">ì¡°íšŒ</button>
      <span>ì´ <span id="totalCount">0</span>ê°œ</span>
    </div>

    <table>
      <thead>
        <tr>
          <th>ì¢…ëª©íŒŒì¼</th>
          <th>ê±°ë¦¬(DTW)</th>
          <th>ë‚ ì§œ</th>
          <th>ì¢…ê°€</th>
        </tr>
      </thead>
      <tbody id="krxTableBody"></tbody>
    </table>
  </div>
</div>

<th:block layout:fragment="pageScript">
<script>
document.getElementById("fetchBtn").addEventListener("click", () => {
  const btn = document.getElementById("fetchBtn");
  btn.disabled = true;
  btn.textContent = "ì¡°íšŒ ì¤‘...";

  const company = document.getElementById("companyInput").value.trim();
  const start = document.getElementById("startDate").value;
  const end = document.getElementById("endDate").value;

  if (!company || !start || !end) {
    alert("íšŒì‚¬ëª…ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    btn.disabled = false;
    btn.textContent = "ì¡°íšŒ";
    return;
  }

  fetch(`/api/krx/similar-advanced?company=${encodeURIComponent(company)}&start=${start}&end=${end}`)
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("krxTableBody");
      const total = document.getElementById("totalCount");
      tbody.innerHTML = "";
      total.textContent = data.length;

      data.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td data-label="ì¢…ëª©íŒŒì¼">${item.file || ''}</td>
          <td data-label="ê±°ë¦¬(DTW)">${item.distance || ''}</td>
          <td data-label="ë‚ ì§œ">${(item.dates || []).join(", ")}</td>
          <td data-label="ì¢…ê°€">${(item.prices || []).join(", ")}</td>
        `;
        tbody.appendChild(tr);
      });

      btn.disabled = false;
      btn.textContent = "ì¡°íšŒ";
    })
    .catch(err => {
      console.error(err);
      btn.disabled = false;
      btn.textContent = "ì¡°íšŒ";
      alert("ë°ì´í„° ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    });
});
</script>
</th:block>
</body>
</html>
